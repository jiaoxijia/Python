!function(t){Array.prototype.filter||(Array.prototype.filter=function(e){"use strict";if(void 0===this||null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var o=[],r=arguments.length>=2?arguments[1]:void 0,i=0;i<n;i++)if(i in t){var a=t[i];e.call(r,a,i,t)&&o.push(a)}return o}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var n;if(null==this)throw new TypeError('"this" is null or not defined');var o=Object(this),r=o.length>>>0;if(0===r)return-1;var i=+t||0;if(Math.abs(i)===1/0&&(i=0),i>=r)return-1;for(n=Math.max(i>=0?i:r-Math.abs(i),0);n<r;){if(n in o&&o[n]===e)return n;n++}return-1});var n,o,r,i,a,d=["dale_group_topic_new_top_right","dale_group_topic_new_bottom_right","dale_group_topic_bottom_super_banner","dale_movie_subject_bottom_super_banner","dale_online_discussion_top_right","dale_personal_note_middle_right","dale_personal_note_bottom_super_banner","dale_anonymous_home_page_bottom","dale_anonymous_home_page_middle_2","dale_music_programme_bottom","dale_newgroup_home_bottom_right_201211","dale_event_page_bottom_right","dale_people_photo_right_image","dale_group_search_top_right","dale_group_explore_bottom_right","dale_book_subject_bottom_super_banner","dale_newgroup_home_bottom_banner_haoye","dale_movie_subject_photo_middle_right_haoye","dale_event_subject_bottom_super_banner","dale_movie_subject_trailer_playing_bottom_right","dale_newgroup_home_bottom_banner_201211","dale_online_photo_top_right_haoye","dale_people_photo_bottom_super_banner","dale_online_subject_bottom_super_banner","dale_movie_tag_bottom_super_banner","dale_newgroup_explore_bottom_banner"];n=function(){var e,n,o,r,i,a,d,l;return n=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},o=function(e,n){n.parentNode.removeChild(n),t[e]=void 0;try{delete t[e]}catch(e){}},r=function(e,t){var n,o,r="";for(n in e)e.hasOwnProperty(n)&&(n=t?encodeURIComponent(n):n,o=t?encodeURIComponent(e[n]):e[n],r+=n+"="+o+"&");return r.replace(/&$/,"")},i=function(){var e="",t=[],n="0123456789ABCDEF",o=0;for(o=0;o<32;o+=1)t[o]=n.charAt(Math.floor(16*Math.random()));return t[12]="4",t[16]=n.charAt(3&t[16]|8),e="erebor_"+t.join("")},a=function(e,t){"undefined"!=typeof e&&e(t)},d=function(e,t,n){"undefined"!=typeof e&&e(t,n)},l=function(e){"undefined"!=typeof e&&e()},e={},e.get=function(e){e=e||{};var u=e.url,c=e.query||{},s=e.callbackParameter||"callback",m=i(),_=t.document.createElement("script"),p=t.document.getElementsByTagName("script")[0],h="?";if("undefined"==typeof u)throw new Error("URL must be specified!");c[s]=m,u.indexOf("?")>=0&&(h="&"),u+=h+r(c,!0),t[m]=function(t){"undefined"==typeof t?a(e.error,"Invalid JSON data returned"):d(e.success,c,t),o(m,_),l(e.complete)},_.setAttribute("src",u),p.parentNode.insertBefore(_,p),n(_,"error",function(){o(m,_),l(e.complete),a(e.error,"Error while trying to access the URL")})},e}();var o=function(e){t.console&&t.console.log(e)},i=function(e){for(;e;){if(e===t.document)return!0;e=e.parentNode}return!1},r=function(e,n){var o="toolbar=0,status=1,resizable=1,menubar=no,location=yes,scrollbars=yes",r=t.window.open(e,n,o);return r&&r.focus(),r},l="",u=(function(){function e(e){var n="visible",o="hidden",r={focus:n,focusin:n,pageshow:n,blur:o,focusout:o,pagehide:o};e=e||window.event,l=e.type in r?r[e.type]:this[t]?"hidden":"visible"}var t="hidden";t in document?document.addEventListener("visibilitychange",e):(t="mozHidden")in document?document.addEventListener("mozvisibilitychange",e):(t="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",e):(t="msHidden")in document?document.addEventListener("msvisibilitychange",e):"onfocusin"in document?document.onfocusin=document.onfocusout=e:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=e,void 0!==document[t]&&e({type:document[t]?"blur":"focus"})}(),function(e){var t=$(e).offset().top,n=t+parseInt(e.height),o=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop,r=document.documentElement.clientHeight;return n>o&&t<o+r}),c=function(){return"hidden"!==l&&"blur"!==l},s=function(t){var n=20,o=setInterval(function(){if(e=document.getElementById(t+"_frame"),null===e)return void clearInterval(o);var r=e.name;n>0&&"CPC"===r?c()&&u(e)&&(DoubanAdGet(t),n--):(clearInterval(o),o=0)},1e4)},m=t.DoubanAdSlots.filter(function(e){return d.indexOf(e)!==-1});setTimeout(function(){for(var e=0;e<m.length;e++)s(m[e])},0);var a=function(e,n){e=e||{},n=n||{};var a=e.unit||"",d=e.elid||a||"",l=e.debug||!1;if(err=n.msg,html=n.html||"",sellType=n.sell_type||"",width=n.width||0,height=n.height||0,margin=n.margin||"",debugHash=n.debug||"",hasIcon=n.has_icon,adSlot=t.document.getElementById(d),adFrame=t.document.getElementById(d+"_frame"),adSlot.setAttribute("data-id",n.ad_id||""),l&&""!==debugHash&&r("http://dale.dapps.douban.com/debug/view/?er="+encodeURIComponent(debugHash)),"undefined"==typeof err){if(!i(adSlot))return void o("Cannot find slot "+a);if(!i(adFrame))if(adFrame=t.document.createElement("iframe"),adFrame.id=d+"_frame",adFrame.frameBorder=0,adFrame.scrolling="no",adFrame.style.overflow="hidden",adFrame.width=width,adFrame.height=height,adFrame.style.display="block",adFrame.src="javascript:document.write('<head><script>window.domain=\"douban.com\";</script></head><body></body>');",hasIcon){var u=t.document.createElement("div"),c=t.document.createElement("div");c.innerHTML="广告",u.style.position="relative",u.style.margin=margin,u.style.display="inline-block",u.style.width=width+"px",u.style.height=height+"px",c.style.lineHeight="1",c.style.textAlign="center",c.style.backgroundColor="rgba(0, 0, 0, .3)",c.style.color="#fff",c.style.fontSize="12px",c.style.position="absolute",c.style.padding="4px",c.style.right="0",c.style.bottom="0",u.appendChild(adFrame),u.appendChild(c),adSlot.appendChild(u)}else adFrame.style.margin=margin,adSlot.appendChild(adFrame);adFrame.name=sellType,adFrame.contentWindow.document.open(),adFrame.contentWindow.document.write(html),adFrame.contentWindow.document.close()}};t.DoubanAdGet=function(e,r,d){var l,u,c=t.DoubanAdRequest||{},e=e||[],r=r||{},s=c.src||"",m=c.uid||"",_=c.bid||"",p=c.crtr||"",h=c.prv||"",f=c.debug||!1,b=(new Date).getTime(),g=[],y="";if("string"==typeof e&&(e=[e]),"function"==typeof r){var v=r;r={};for(var w=0;w<e.length;w++)r[e[w]]=v}if(""===s)throw new Error("Ad service url must be specified!");if(""===_)throw new Error("Browser id must be specified!");""!==h&&(s+="preview/");for(var E,w=0,A="";w<e.length;w++){if(d&&d[w]){E=d[w],A=E.el||"";var F=E.id;l=t.document.getElementById(A),F=F||l.getAttribute("data-id")||"",F&&g.push(F),y=g.join(",")}else l=t.document.getElementById(e[w]);i(l)?(u={unit:e[w],uid:m,bid:_,crtr:p,ts:b,prv:h,debug:f,ad_id:y,elid:A},n.get({url:s,query:u,success:r[e[w]]||a,error:o})):o("Nonexistent slot "+e[w])}},t.DoubanAdGet(t.DoubanAdSlots,t.DoubanAdLoaders,t.adElements)}(this);
